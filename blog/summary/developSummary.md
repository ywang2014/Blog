# 开发总结
&emsp;&emsp;工作实践中的小感悟，遇到的坑不少，希望以后可以避免。来源一：老项目的修改，比如：业务增长，需要扩展功能，或者接入新的供应商等。来源二：使用中间件过程中遇到的问题，提供中间件非常好，减少重复造轮子，但是提供的中间件一定要好用，简单、方便，不能让用户使用的时候，遇到各种问题，缺少奇奇怪怪的配置和环境依赖，必须的依赖，尽量做成支持用户灵活配置，可以根据实际情况修改等。特别是非必须的功能，应该允许用户关闭，不使用。

头条工作的一点体会！

**Date：2019-07-04**

## 扩展性
&emsp;&emsp;1.多使用设计模式，减少代码修改，支持更好的扩展性。-- 开闭原则
	
	比如：
		1.策略模式
		2.工厂模式
		少写if-else，将各种的分支和策略，尽量放在具体的类实现中，特别是条件明显会扩展的情况，多供应商，多业务线的场景。

## 灵活性
&emsp;&emsp;1.可能需要修改的内容，尽量做成可配置的方式，允许少数用户修改。，或者区分环境等。
	
	比如：
		1.注册服务，最简单支持yml文件启动、禁用。
		2.服务发现，允许yml配置，支持是否使用代理模式。
		3.consul服务发现地址，允许用户修改，不能写死某个地址。
	原因：这些内容如果不能修改，用户使用必须有这些特定条件，才能使用，通常构建环境很麻烦。
	场景：中间件、jar包

&emsp;&emsp;2.经常需要修改的内容，最好放在数据库、ETCD配置中心、Redis等地方。
	
	比如：
		1.业务白名单，可能经常需要添加，删除啥的。
		2.通知模板，通常也会随着业务变更的。
	原因：修改代码，或者配置文件，都需要上线、发布，太麻烦。
	场景：业务系统服务

#### 鲁棒性
&emsp;&emsp;1.TDD驱动开发，保证单测覆盖率，保证代码质量、单测质量

## 数据库
#### 读写分离
1.读库的用户名和密码一定要配置成只读账号，避免程序代码，或者配置写错了，对从库进行了写入数据，影响主从同步不可用，导致整个服务不可用。

2.数据库的密码，不同账号（特别是读写账号）不应该一样，否则也可以直接触发。（用户名修改，密码没有修改，也能触发连接失败问题）

3.事物处理过程，只能使用写的数据源，即使里面有读操作。因为：在事物中，无法在切换数据源时，保证事物完整性。

4.连接池问题，要考虑充分，如何实现服务发现，如何自动刷新等问题。

#### 事务处理
1.事务中的异步操作，需要注意数据库隔离级别问题。
	Repeatable Read 中，如果异步操作执行时，事务未提交完成，导致不可读新数据，只能读取老数据。（现象：debug模式下，程序查询的一直是旧数据，数据库客户端查询的是新数据）
	Read commit 中，如果异步操作执行时，事务未提交完成，导致不可读新数据，等一会儿，事务提交之后，可以读取新数据。
